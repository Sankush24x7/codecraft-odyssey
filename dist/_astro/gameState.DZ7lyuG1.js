const h="codecraft_odyssey_save",n={playerId:null,playerName:"Adventurer",currentLevel:1,totalXP:0,currentWorld:1,health:3,maxHealth:3,completedLevels:[],badges:[],unlockedWorlds:[1],streak:0,lastPlayed:null,settings:{soundEnabled:!0,theme:"auto"},stats:{totalMissionsCompleted:0,totalHintsUsed:0,fastestCompletion:null,perfectRuns:0}};class u{constructor(){this.state=this.load()}load(){if(typeof localStorage>"u")return{...n};const t=localStorage.getItem(h);if(!t){const e={...n,playerId:this.generateId(),lastPlayed:new Date().toISOString()};return this.save(e),e}return JSON.parse(t)}save(t=this.state){typeof localStorage>"u"||(t.lastPlayed=new Date().toISOString(),localStorage.setItem(h,JSON.stringify(t)),this.state=t)}generateId(){return"player_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}get(){return this.state}setPlayerName(t){this.state.playerName=t,this.save()}completeLevel(t,e,s,r=0){this.state.completedLevels.includes(t)||(this.state.completedLevels.push(t),this.state.stats.totalMissionsCompleted++),this.state.totalXP+=e,this.state.stats.totalHintsUsed+=r,(!this.state.stats.fastestCompletion||s<this.state.stats.fastestCompletion)&&(this.state.stats.fastestCompletion=s),r===0&&this.state.health===this.state.maxHealth&&this.state.stats.perfectRuns++;const a=this.calculateLevel(this.state.totalXP);return a>this.state.currentLevel&&(this.state.currentLevel=a,this.unlockWorld(Math.ceil(a/15))),this.state.health=this.state.maxHealth,this.save(),{levelUp:a>this.state.currentLevel,newLevel:a,totalXP:this.state.totalXP}}calculateLevel(t){let e=1,s=0;for(;t>=s;)e++,s+=e*100;return e-1}getLevelProgress(){const t=this.state.currentLevel,e=this.state.totalXP;let s=0;for(let l=1;l<t;l++)s+=(l+1)*100;const r=s+(t+1)*100,a=e-s,o=r-s;return{current:a,required:o,percentage:Math.floor(a/o*100)}}takeDamage(){return this.state.health=Math.max(0,this.state.health-1),this.save(),this.state.health}resetHealth(){this.state.health=this.state.maxHealth,this.save()}unlockBadge(t){return this.state.badges.includes(t)?!1:(this.state.badges.push(t),this.save(),!0)}unlockWorld(t){return this.state.unlockedWorlds.includes(t)?!1:(this.state.unlockedWorlds.push(t),this.save(),!0)}isLevelUnlocked(t){return t===1?!0:this.state.completedLevels.includes(t-1)}reset(){this.state={...n,playerId:this.generateId(),lastPlayed:new Date().toISOString()},this.save()}export(){return JSON.stringify(this.state,null,2)}import(t){try{const e=JSON.parse(t);return this.state=e,this.save(),!0}catch(e){return console.error("Failed to import save:",e),!1}}}let i=null;function d(){return typeof window>"u"?new u:(i||(i=new u),i)}export{d as g};
